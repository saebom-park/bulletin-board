<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>로그인</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/bulletin.css}">
</head>

<body class="bb-body">

<!-- Toast Messages (공통) -->
<div class="bb-toast-area"
     th:if="${successMessage != null or errorMessage != null}">

    <div th:if="${successMessage}"
         class="bb-toast bb-toast--success"
         data-auto-dismiss="3000">
        <div class="bb-toast__icon">✓</div>
        <div class="bb-toast__body">
            <p class="bb-toast__title">완료</p>
            <p class="bb-toast__msg" th:text="${successMessage}">성공 메시지</p>
        </div>
        <button type="button" class="bb-toast__close" aria-label="닫기">×</button>
    </div>

    <div th:if="${errorMessage}"
         class="bb-toast bb-toast--danger"
         data-auto-dismiss="4500">
        <div class="bb-toast__icon">!</div>
        <div class="bb-toast__body">
            <p class="bb-toast__title">오류</p>
            <p class="bb-toast__msg" th:text="${errorMessage}">에러 메시지</p>
        </div>
        <button type="button" class="bb-toast__close" aria-label="닫기">×</button>
    </div>

</div>

<div class="bb-login-wrapper">

    <div class="bb-login-card">

        <h1 class="bb-login-title">로그인</h1>
        <p class="bb-login-sub">서비스를 이용하려면 로그인해주세요.</p>

        <form th:action="@{/login}" th:object="${loginForm}" method="post">

            <input type="hidden" name="redirectURL" th:value="${redirectURL}"/>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

            <div class="bb-login-form-group">
                <label class="bb-login-label">아이디</label>
                <input class="bb-login-input"
                       type="text"
                       th:field="*{username}"
                       th:classappend="${#fields.hasErrors('username')} ? ' bb-input--error'">
                <div th:if="${#fields.hasErrors('username')}"
                     th:errors="*{username}"
                     class="bb-login-error">
                </div>
            </div>

            <div class="bb-login-form-group">
                <label class="bb-login-label">비밀번호</label>
                <input class="bb-login-input"
                       type="password"
                       th:field="*{password}"
                       th:classappend="${#fields.hasErrors('password')} ? ' bb-input--error'">
                <div th:if="${#fields.hasErrors('password')}"
                     th:errors="*{password}"
                     class="bb-login-error">
                </div>
            </div>

            <div th:if="${#fields.hasGlobalErrors()}"
                 class="bb-login-error"
                 style="margin-bottom: 10px;">
                <p th:each="err : ${#fields.globalErrors()}"
                   th:text="${err}"></p>
            </div>

            <button type="submit" class="bb-login-btn">로그인</button>
        </form>

    </div>

</div>

<script th:inline="javascript">
    (function () {
        /* ===========================
           Sidebar Toggle
        =========================== */

        const sidebar = document.querySelector('.bb-sidebar');
        const toggleBtn = document.getElementById('sidebar-toggle');
        const backdrop = document.getElementById('sidebar-backdrop');
        const body = document.body;

        function openSidebar() {
            sidebar.classList.add('bb-sidebar--open');
            if (backdrop) {
                backdrop.classList.add('bb-sidebar-backdrop--visible');
                backdrop.style.display = 'block';
            }
            body.classList.add('bb-body--no-scroll');
        }

        function closeSidebar() {
            sidebar.classList.remove('bb-sidebar--open');
            if (backdrop) {
                backdrop.classList.remove('bb-sidebar-backdrop--visible');
                setTimeout(() => { backdrop.style.display = 'none'; }, 200);
            }
            body.classList.remove('bb-body--no-scroll');
        }

        if (sidebar && toggleBtn) {
            toggleBtn.addEventListener('click', function () {
                const isOpen = sidebar.classList.contains('bb-sidebar--open');
                isOpen ? closeSidebar() : openSidebar();
            });
        }

        if (backdrop) {
            backdrop.addEventListener('click', closeSidebar);
        }

        /* ===========================
           Toast Auto Dismiss
        =========================== */

        const toasts = document.querySelectorAll('.bb-toast');
        if (!toasts || toasts.length === 0) return;

        function hideToast(toast) {
            if (!toast || toast.classList.contains('bb-toast--hide')) return;
            toast.classList.add('bb-toast--hide');

            setTimeout(() => {
                toast.remove();
                const area = document.querySelector('.bb-toast-area');
                if (area && area.children.length === 0) {
                    area.remove();
                }
            }, 220);
        }

        toasts.forEach((toast) => {
            const closeBtn = toast.querySelector('.bb-toast__close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => hideToast(toast));
            }

            const ms = Number(toast.getAttribute('data-auto-dismiss') || '0');
            if (ms > 0) {
                setTimeout(() => hideToast(toast), ms);
            }
        });
    })();
</script>

</body>
</html>