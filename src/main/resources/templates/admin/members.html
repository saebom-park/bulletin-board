<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::content})}">
<body>
<section th:fragment="content" class="bb-stack bb-stack--lg">

    <!-- 라벨 맵(한글 표시용) -->
    <th:block th:with="
        statusLabels=${ {'ACTIVE':'활성', 'INACTIVE':'비활성', 'BLOCKED':'차단', 'WITHDRAW':'탈퇴'} },
        roleLabels=${ {'ROLE_ADMIN':'관리자', 'ROLE_USER':'일반 회원'} }
    ">

        <div class="bb-card bb-card--spaced">

            <!-- 헤더: 타이틀 + 설명 + 우측 필터/액션 -->
            <div class="bb-card__header bb-card__header--split">
                <div>
                    <h1 class="bb-page-title">회원 관리</h1>
                    <p class="bb-page-subtitle">
                        계정 상태 변경은 관리자만 가능합니다.
                    </p>
                </div>

                <div class="bb-actions bb-actions--right bb-admin-actions">
                    <!-- 상태 필터 -->
                    <form th:action="@{/admin/members}" method="get" class="bb-inline bb-inline--tight">
                        <select name="status" class="bb-select bb-select--sm">
                            <option value="">전체 상태</option>
                            <option th:each="s : ${statuses}"
                                    th:value="${s}"
                                    th:text="${statusLabels[s.name()]}"
                                    th:selected="${param.status != null and param.status[0] == s.name()}">
                            </option>
                        </select>
                        <button type="submit" class="bb-btn bb-btn--subtle bb-btn--sm">필터</button>
                    </form>
                </div>
            </div>

            <!-- 테이블 -->
            <div class="bb-table-wrapper">
                <table class="bb-table">
                    <thead>
                    <tr>
                        <th>번호</th>
                        <th class="bb-col-id">ID</th>
                        <th>아이디</th>
                        <th>이름</th>
                        <th>가입일</th>
                        <th class="bb-col-role">권한</th>
                        <th class="bb-col-status">상태</th>
                        <th class="bb-col-action">변경</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr th:if="${#lists.isEmpty(members)}">
                        <td colspan="8" class="bb-table-empty">
                            조회된 회원이 없습니다.
                        </td>
                    </tr>

                    <tr th:each="m, stat : ${members}">
                        <td th:text="${#lists.size(members) - stat.index}">1</td>
                        <td class="bb-col-id" th:text="${m.id}">1</td>

                        <td>
                            <div class="bb-admin-user">
                                <span class="bb-admin-username" th:text="${m.username}">user</span>
                            </div>
                        </td>

                        <td th:text="${m.name}">name</td>

                        <td class="bb-col-email" th:text="${#temporals.format(m.createdAt, 'yyyy-MM-dd')}">createdAt</td>

                        <td class="bb-col-role">
                            <span class="bb-role-badge"
                                  th:classappend="${m.role == 'ROLE_ADMIN'} ? ' bb-role-badge--admin' : ''"
                                  th:text="${roleLabels[m.role]}">
                            </span>
                        </td>

                        <td class="bb-col-status">
                            <select name="status"
                                    class="bb-select bb-select--sm"
                                    th:form="|statusForm__${m.id}|">
                                <option th:each="s : ${statuses}"
                                        th:value="${s}"
                                        th:text="${statusLabels[s.name()]}"
                                        th:selected="${s == m.status}">
                                </option>
                            </select>
                        </td>

                        <td class="bb-col-action">
                            <form th:id="|statusForm__${m.id}|"
                                  th:action="@{|/admin/members/${m.id}/status|}"
                                  method="post"
                                  class="bb-inline bb-inline--tight">
                                <button type="submit" class="bb-btn bb-btn--primary bb-btn--sm">
                                    적용
                                </button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <p class="bb-form-hint" style="margin-top: 10px;">
                * 상태 변경은 즉시 반영됩니다.
            </p>

        </div>

    </th:block>

</section>
</body>
</html>